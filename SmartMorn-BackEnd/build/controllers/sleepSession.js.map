{"version":3,"sources":["../../src/controllers/sleepSession.js"],"names":["setSleep","req","res","sleepTime","body","time","token","headers","user","jwt","verify","error","json","message","userID","returnData","length","date","alarm","returnCheckExist"],"mappings":";;;;;;;AAAA;;;;AACA;;;;AACA;;;;;;AAEO,IAAMA,8BAAW,SAAXA,QAAW,CAACC,GAAD,EAAKC,GAAL,EAAa;AACjC,QAAIC,YAAYF,IAAIG,IAAJ,CAASC,IAAzB;AACA,QAAMC,QAAQL,IAAIM,OAAJ,CAAY,gBAAZ,CAAd;;AAEA,QAAI;AACA,YAAIC,OAAOC,uBAAIC,MAAJ,CAAWJ,KAAX,EAAkB,cAAlB,CAAX;AACH,KAFD,CAEE,OAAMK,KAAN,EAAa;AACX,eAAOT,IAAIU,IAAJ,CAAS;AACZD,mBAAO,IADK;AAEZE,qBAAS;AAFG,SAAT,CAAP;AAIH;;AAED,4BAAG,2CAAH,EAA+C,CAAEL,KAAKM,MAAP,CAA/C,EAA+D,UAACC,UAAD,EAAgB;AAC3E,YAAGA,WAAWC,MAAX,IAAqB,CAAxB,EAA2B;AACvB,oCAAG,6BAAH,EAAiC;AAC7BF,wBAAQN,KAAKM,MADgB;AAE7BX,2BAAYc,OAAK,GAAL,GAASZ,IAFQ;AAG7Ba,uBAAO;AAHsB,aAAjC,EAIE,UAACC,gBAAD,EAAsB;AACpBjB,oBAAIU,IAAJ,CAAS;AACLD,2BAAO,KADF;AAELE,6BAAS;AAFJ,iBAAT;AAIH,aATD;AAUH,SAXD,MAWO;AACH,oCAAG,wDAAH,EAA4D,CAAEV,YAAU,KAAZ,EAAmBK,KAAKM,MAAxB,CAA5D,EAA6F,UAACK,gBAAD,EAAsB;AAC/GjB,oBAAIU,IAAJ,CAAS;AACLD,2BAAO,KADF;AAELE,6BAAS;AAFJ,iBAAT;AAIH,aALD;AAMH;AACJ,KApBD;AAqBH,CAlCM","file":"sleepSession.js","sourcesContent":["import jwt from 'jsonwebtoken';\nimport db from '../utils/database';\nimport md5 from 'md5';\n\nexport const setSleep = (req,res) => {\n    let sleepTime = req.body.time;\n    const token = req.headers['x-access-token'];\n\n    try {\n        var user = jwt.verify(token, 'SuperHeroLOL');\n    } catch(error) {\n        return res.json({\n            error: true,\n            message: 'Not allow'\n        }); \n    }\n    \n    db('SELECT * FROM `config` WHERE `userID` = ?',[ user.userID ],(returnData) => {\n        if(returnData.length == 0) {\n            db('INSERT INTO `config` SET ? ',{\n                userID: user.userID,\n                sleepTime:  date+' '+time,\n                alarm: '0000-00-00 00:00:00'\n            },(returnCheckExist) => {\n                res.json({\n                    error: false,\n                    message: 'Set sleep session success'\n                });\n            });\n        } else {\n            db('UPDATE `config` SET `sleepTime` = ? WHERE `userID` = ?',[ sleepTime+':00', user.userID ],(returnCheckExist) => {\n                res.json({\n                    error: false,\n                    message: 'Set sleep session success'\n                });\n            });\n        }\n    });\n}"]}