{"version":3,"sources":["../../src/controllers/alarm.js"],"names":["setalarm","req","res","date","body","time","token","headers","user","jwt","verify","error","json","message","userID","returnData","length","sleepSession","alarm","returnCheckExist"],"mappings":";;;;;;;AAAA;;;;AACA;;;;AACA;;;;;;AAEO,IAAMA,8BAAW,SAAXA,QAAW,CAACC,GAAD,EAAKC,GAAL,EAAa;AACjC,QAAIC,OAAOF,IAAIG,IAAJ,CAASD,IAApB;AACA,QAAIE,OAAOJ,IAAIG,IAAJ,CAASC,IAApB;;AAEA,QAAMC,QAAQL,IAAIM,OAAJ,CAAY,gBAAZ,CAAd;;AAEA,QAAI;AACA,YAAIC,OAAOC,uBAAIC,MAAJ,CAAWJ,KAAX,EAAkB,cAAlB,CAAX;AACH,KAFD,CAEE,OAAMK,KAAN,EAAa;AACX,eAAOT,IAAIU,IAAJ,CAAS;AACZD,mBAAO,IADK;AAEZE,qBAAS;AAFG,SAAT,CAAP;AAIH;;AAED,4BAAG,2CAAH,EAA+C,CAAEL,KAAKM,MAAP,CAA/C,EAA+D,UAACC,UAAD,EAAgB;AAC3E,YAAGA,WAAWC,MAAX,IAAqB,CAAxB,EAA2B;AACvB,oCAAG,6BAAH,EAAiC;AAC7BF,wBAAQN,KAAKM,MADgB;AAE7BG,8BAAc,qBAFe;AAG7BC,uBAAOf,OAAK,GAAL,GAASE;AAHa,aAAjC,EAIE,UAACc,gBAAD,EAAsB;AACpBjB,oBAAIU,IAAJ,CAAS;AACLD,2BAAO,KADF;AAELE,6BAAS;AAFJ,iBAAT;AAIH,aATD;AAUH,SAXD,MAWO;AACH,oCAAG,oDAAH,EAAwD,CAAEV,OAAK,GAAL,GAASE,IAAX,EAAiBG,KAAKM,MAAtB,CAAxD,EAAuF,UAACK,gBAAD,EAAsB;AACzGjB,oBAAIU,IAAJ,CAAS;AACLD,2BAAO,KADF;AAELE,6BAAS;AAFJ,iBAAT;AAIH,aALD;AAMH;AACJ,KApBD;AAqBH,CApCM","file":"alarm.js","sourcesContent":["import jwt from 'jsonwebtoken';\nimport db from '../utils/database';\nimport md5 from 'md5';\n\nexport const setalarm = (req,res) => {\n    let date = req.body.date;\n    let time = req.body.time;\n\n    const token = req.headers['x-access-token'];\n\n    try {\n        var user = jwt.verify(token, 'SuperHeroLOL');\n    } catch(error) {\n        return res.json({\n            error: true,\n            message: 'Not allow'\n        }); \n    }\n    \n    db('SELECT * FROM `config` WHERE `userID` = ?',[ user.userID ],(returnData) => {\n        if(returnData.length == 0) {\n            db('INSERT INTO `config` SET ? ',{\n                userID: user.userID,\n                sleepSession: '0000-00-00 00:00:00',\n                alarm: date+' '+time\n            },(returnCheckExist) => {\n                res.json({\n                    error: false,\n                    message: 'Set alarm success'\n                });\n            });\n        } else {\n            db('UPDATE `config` SET `alarm` = ? WHERE `userID` = ?',[ date+' '+time, user.userID ],(returnCheckExist) => {\n                res.json({\n                    error: false,\n                    message: 'Set alarm success'\n                });\n            });\n        }\n    });\n}"]}